<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>DoctorScan — Subir Radiografía</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-wrap">
    <h1 class="hero-title">Bienvenido, Doctor</h1>
    <p class="hero-sub">Sube una radiografía para análisis de cáncer</p>

    <section class="panel">
      <div class="drop" id="drop">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        <h3 class="title">Arrastra o haz clic para subir radiografía</h3>
        <p class="hint">Formatos: JPG, PNG, máximo 5MB</p>
        <input id="file" class="hidden-input" type="file" accept=".jpg,.jpeg,.png" />
      </div>
      <div id="preview" class="preview" aria-live="polite"></div>
    </section>

    <div class="actions">
      <button id="analyzeBtn" class="primary-btn" disabled>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        Analizar Imagen
      </button>
    </div>
  </div>

  <script>
    // Utilidades
    function bytesMB(b){ return (b/1024/1024).toFixed(2); }
    function el(t, attrs){ return Object.assign(document.createElement(t), attrs || {}); }

    // DOM
    var drop = document.getElementById('drop');
    var fileInput = document.getElementById('file');
    var preview = document.getElementById('preview');
    var analyzeBtn = document.getElementById('analyzeBtn');

    // Reglas
    var VALID = ['image/jpeg','image/png'];
    var MAX_MB = 5;

    function setEnabled(ok){
      analyzeBtn.disabled = !ok;
      if (ok) analyzeBtn.classList.add('enabled'); else analyzeBtn.classList.remove('enabled');
    }

    function describe(file){
      preview.innerHTML = '';
      var p = el('p');
      p.textContent = 'Archivo: ' + file.name + ' — ' + bytesMB(file.size) + ' MB';
      preview.appendChild(p);

      if (file.type.indexOf('image/') === 0){
        var img = el('img');
        img.alt = 'Vista previa';
        img.src = URL.createObjectURL(file);
        preview.appendChild(img);
      }
    }

    function validate(file){
      if (!file) return { ok:false, msg:'Ningún archivo seleccionado.' };
      if (VALID.indexOf(file.type) === -1) return { ok:false, msg:'Formato inválido. Usa JPG o PNG.' };
      if (file.size > MAX_MB*1024*1024) return { ok:false, msg:'El archivo supera ' + MAX_MB + 'MB.' };
      return { ok:true };
    }

    function handleFiles(files){
      var file = files && files[0];
      var res = validate(file);
      if (!res.ok){
        preview.innerHTML = '<p class="status-err">' + res.msg + '</p>';
        setEnabled(false);
        return;
      }
      describe(file);
      preview.insertAdjacentHTML('beforeend', '<p class="status-ok">Listo para analizar.</p>');
      setEnabled(true);
      analyzeBtn.dataset.blobUrl = URL.createObjectURL(file);
    }

    // Eventos
    drop.addEventListener('click', function(){ fileInput.click(); });
    fileInput.addEventListener('change', function(e){ handleFiles(e.target.files); });

    ['dragenter','dragover'].forEach(function(ev){
      drop.addEventListener(ev, function(e){
        e.preventDefault(); e.stopPropagation();
        drop.style.background = 'rgba(59,130,246,.05)';
      });
    });
    ['dragleave','drop'].forEach(function(ev){
      drop.addEventListener(ev, function(e){
        e.preventDefault(); e.stopPropagation();
        drop.style.background = 'transparent';
      });
    });
    drop.addEventListener('drop', function(e){ handleFiles(e.dataTransfer.files); });

    analyzeBtn.addEventListener('click', function(){
      if (analyzeBtn.disabled) return;
      var btnText = analyzeBtn.innerHTML;
      analyzeBtn.innerHTML = '<span style="font-weight:800">Analizando…</span>';
      analyzeBtn.style.filter = 'brightness(.95)';
      setTimeout(function(){
        analyzeBtn.innerHTML = btnText;
        analyzeBtn.style.filter = '';
        alert('✅ Análisis de demostración completado.');
      }, 900);
    });
  </script>
</body>
</html>
